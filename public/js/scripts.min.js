"use strict";function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise(function(e,t){function n(o,i){try{var a=r[o](i),c=a.value}catch(u){return void t(u)}return a.done?void e(c):Promise.resolve(c).then(function(e){n("next",e)},function(e){n("throw",e)})}return n("next")})}}var StartApp=angular.module("StartApp",[]),helpers=function(){var e=function(e){return e.toISOString().substring(0,10)};return{toDateIso:e}}(),serviceWorker=function(){var e=function(){navigator.serviceWorker.controller?console.log(navigator.serviceWorker.controller.scriptURL+" already registered"):navigator.serviceWorker.register("/service-worker.js",{scope:"./"}).then(function(e){console.log(e.scope+" registered"),console.log("Service worker change, registered the service worker")})},r=function(){navigator.serviceWorker.getRegistration().then(function(e){e.unregister(),console.log("unregistered service worker:",e)})},t=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function r(){var e;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,caches.keys();case 2:e=r.sent,e.forEach(function(e){caches["delete"](e)});case 4:case"end":return r.stop()}},r,this)}));return function(){return e.apply(this,arguments)}}();return{register:e,unregister:r,deleteCaches:t}}();StartApp.factory("BackgroundApi",["$http",function(e){var r=function(r){return e({method:"GET",url:"/background",params:{date:r}})};return{get:r}}]),StartApp.factory("LinksApi",["$http",function(e){var r=function(){return e({method:"GET",url:"/links.json"})};return{get:r}}]),StartApp.controller("LinksController",["$scope","LinksApi",function(e,r){e.links=[],r.get().then(function(r){var t=r.data;e.links=t})}]),StartApp.controller("Background",["$scope","$sce","BackgroundApi",function(e,r,t){var n=-1;e.loaded=!1,e.show=!1,e.isNextBackground=!1,e.hide=!1;var o=function(e,r){return Math.sqrt(Math.pow(e-r,2))},i=function(){var i=new Date;i.setDate(i.getDate()+n);var a=new Promise(function(n,a){t.get(helpers.toDateIso(i)).then(function(t){var i=t.data.data[0].attributes,a=null;i.image.renditions.forEach(function(e){null==a&&(a=e);var r=o(window.innerWidth,e.width);r<o(window.innerWidth,a.width)&&(a=e)}),e.data={backgroundUrl:a.uri.replace("http:","https:"),title:i.image.title,description:r.trustAsHtml(i.image.caption),link:i.uri},e.loaded=!0,n()})});return a};e.prevBackground=function(){n--,i().then(function(){e.isNextBackground=!0,e.$apply()})},e.nextBackground=function(){n++,i().then(function(){n==-1&&(e.isNextBackground=!1,e.$apply())})},i(),e.press=function(r){console.log(r),27==r.keyCode&&(e.hide=!e.hide),37==r.keyCode&&e.prevBackground(),39==r.keyCode&&e.nextBackground()}}]),StartApp.controller("AboutImageController",["$scope","$sce","BackgroundApi",function(e,r,t){}]),window.config.useServiceWorker&&serviceWorker.register();